# 图片粘贴功能使用指南

## 功能概述

在编辑器中支持直接粘贴图片（Ctrl+V），图片会自动上传到本地存储，并在 Markdown 中插入图片引用。

## 使用方法

1. **复制图片**：
   - 从截图工具复制图片
   - 从浏览器复制图片
   - 从文件管理器复制图片文件

2. **粘贴图片**：
   - 在编辑器的编辑模式下（点击内容区域进入编辑模式）
   - 按 `Ctrl+V` 粘贴图片
   - 会看到"正在上传图片..."的占位符
   - 上传完成后自动替换为图片 Markdown 语法

3. **查看图片**：
   - 退出编辑模式（点击外部或失焦）
   - 图片会在预览模式下自动渲染显示

## 技术实现

### 存储结构

图片保存在 `vault/assets/{promptId}/` 目录下：

```
vault/
  assets/
    {promptId}/
      image-1234567890-abc123.png
      image-1234567891-def456.jpg
```

### Markdown 引用格式

```markdown
![图片](assets/{promptId}/image-1234567890-abc123.png)
```

### API 端点

- **上传图片**: `POST /api/images/upload`
  - Body: `{ imageData: "data:image/png;base64,...", promptId: "..." }`
  - Response: `{ success: true, path: "assets/...", fileName: "..." }`

- **获取图片**: `GET /api/images/{promptId}/{fileName}`
  - 返回图片文件

## 特性

- ✅ 自动生成唯一文件名（时间戳 + 随机字符串）
- ✅ 支持 PNG、JPEG 等常见图片格式
- ✅ 懒加载优化（只加载可见区域的图片）
- ✅ 占位符机制（上传过程中显示进度）
- ✅ 本地存储（不依赖外部服务）
- ✅ 相对路径引用（便于备份和迁移）

## 注意事项

1. 图片会保存在对应提示词的 assets 目录下
2. 删除提示词时，相关图片不会自动删除（需要手动清理）
3. 图片文件名包含时间戳，避免冲突
4. 支持的图片格式：PNG, JPEG, GIF, WebP 等浏览器支持的格式

## 性能优化

- 使用懒加载，只加载可见区域的图片
- 图片以 base64 传输，避免额外的文件系统操作
- 服务端直接写入文件，避免前端内存占用
