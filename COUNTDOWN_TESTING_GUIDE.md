# å€’è®¡æ—¶ç³»ç»Ÿè‡ªåŠ¨åŒ–æµ‹è¯•æŒ‡å—

> **æ—¥æœŸ**: 2026-01-26  
> **çŠ¶æ€**: æµ‹è¯•å¥—ä»¶å·²åˆ›å»º âœ…

---

## ğŸ“‹ æµ‹è¯•æ¦‚è§ˆ

### æµ‹è¯•æ–‡ä»¶ç»“æ„

```
src/__tests__/
â”œâ”€â”€ setup.ts                                    # å…¨å±€æµ‹è¯•é…ç½®
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ countdownManager.test.ts               # CountdownManager å•å…ƒæµ‹è¯•
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useCountdownManager.test.tsx           # Hook é›†æˆæµ‹è¯•
â”œâ”€â”€ performance/
â”‚   â””â”€â”€ countdown.perf.test.ts                 # æ€§èƒ½æµ‹è¯•
â””â”€â”€ integration/
    â””â”€â”€ countdown-system.test.tsx              # ç³»ç»Ÿé›†æˆæµ‹è¯•
```

### æµ‹è¯•è¦†ç›–èŒƒå›´

| æµ‹è¯•ç±»å‹ | æ–‡ä»¶ | æµ‹è¯•æ•°é‡ | è¦†ç›–å†…å®¹ |
|---------|------|---------|---------|
| **å•å…ƒæµ‹è¯•** | `countdownManager.test.ts` | 40+ | CountdownManager æ ¸å¿ƒåŠŸèƒ½ |
| **Hook æµ‹è¯•** | `useCountdownManager.test.tsx` | 20+ | React Hook é›†æˆ |
| **æ€§èƒ½æµ‹è¯•** | `countdown.perf.test.ts` | 15+ | å¤§é‡ä»»åŠ¡åœºæ™¯ |
| **é›†æˆæµ‹è¯•** | `countdown-system.test.tsx` | 20+ | å®Œæ•´ç³»ç»Ÿæµç¨‹ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

æ–°å¢çš„æµ‹è¯•ä¾èµ–ï¼š
- `vitest` - ç°ä»£åŒ–æµ‹è¯•æ¡†æ¶
- `@testing-library/react` - React ç»„ä»¶æµ‹è¯•
- `@testing-library/jest-dom` - DOM æ–­è¨€æ‰©å±•
- `jsdom` - DOM ç¯å¢ƒæ¨¡æ‹Ÿ
- `@vitest/ui` - æµ‹è¯• UI ç•Œé¢
- `@vitest/coverage-v8` - ä»£ç è¦†ç›–ç‡

### 2. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆç›‘å¬æ¨¡å¼ï¼‰
npm test

# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆå•æ¬¡ï¼‰
npm run test:run

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# è¿è¡Œæµ‹è¯• UI ç•Œé¢
npm run test:ui

# è¿è¡Œç‰¹å®šæµ‹è¯•
npm run test:countdown      # å€’è®¡æ—¶æ ¸å¿ƒæµ‹è¯•
npm run test:perf          # æ€§èƒ½æµ‹è¯•
npm run test:integration   # é›†æˆæµ‹è¯•
```

---

## ğŸ“Š æµ‹è¯•è¯¦æƒ…

### 1. CountdownManager å•å…ƒæµ‹è¯•

**æ–‡ä»¶**: `src/__tests__/utils/countdownManager.test.ts`

#### æµ‹è¯•åˆ†ç»„

##### åŸºç¡€åŠŸèƒ½
- âœ… æ­£ç¡®æ³¨å†Œä»»åŠ¡
- âœ… æ­£ç¡®å–æ¶ˆæ³¨å†Œä»»åŠ¡
- âœ… é˜²æ­¢é‡å¤æ³¨å†Œç›¸åŒä»»åŠ¡
- âœ… å…è®¸æ³¨å†Œå¤šä¸ªä¸åŒä»»åŠ¡

##### è®¢é˜…æœºåˆ¶
- âœ… æ­£ç¡®è®¢é˜…ä»»åŠ¡æ›´æ–°
- âœ… æ­£ç¡®å–æ¶ˆè®¢é˜…
- âœ… æ”¯æŒå¤šä¸ªè®¢é˜…è€…
- âœ… è®¢é˜…æ—¶ç«‹å³è¿”å›å½“å‰æ•°æ®

##### å€’è®¡æ—¶è®¡ç®—
- âœ… æ­£ç¡®è®¡ç®—æœªè¿‡æœŸä»»åŠ¡çš„å€’è®¡æ—¶
- âœ… æ­£ç¡®è¯†åˆ«å·²è¿‡æœŸä»»åŠ¡
- âœ… æ­£ç¡®è®¡ç®—è¿›åº¦ç™¾åˆ†æ¯”
- âœ… å¤„ç†æ— æ•ˆæ—¥æœŸ

##### è¿‡æœŸå›è°ƒ
- âœ… åœ¨ä»»åŠ¡è¿‡æœŸæ—¶è§¦å‘å›è°ƒ
- âœ… é˜²æ­¢é‡å¤è§¦å‘è¿‡æœŸå›è°ƒ
- âœ… å¤„ç†å›è°ƒä¸­çš„é”™è¯¯

##### æ€§èƒ½ä¼˜åŒ–
- âœ… ä½¿ç”¨å•ä¸€ RAF å¾ªç¯ç®¡ç†å¤šä¸ªä»»åŠ¡
- âœ… åœ¨æ²¡æœ‰ä»»åŠ¡æ—¶åœæ­¢å¾ªç¯
- âœ… èŠ‚æµè¿›åº¦æ›´æ–°

##### é¡µé¢å¯è§æ€§ä¼˜åŒ–
- âœ… åœ¨é¡µé¢éšè—æ—¶é™ä½æ›´æ–°é¢‘ç‡
- âœ… åœ¨é¡µé¢å¯è§æ—¶æ¢å¤æ­£å¸¸æ›´æ–°é¢‘ç‡

##### è¾¹ç•Œæƒ…å†µ
- âœ… å¤„ç†ç©ºä»»åŠ¡åˆ—è¡¨
- âœ… å¤„ç†è®¢é˜…ä¸å­˜åœ¨çš„ä»»åŠ¡
- âœ… å¤„ç†å–æ¶ˆè®¢é˜…ä¸å­˜åœ¨çš„ä»»åŠ¡
- âœ… å¤„ç†è®¢é˜…å›è°ƒä¸­çš„é”™è¯¯

##### å†…å­˜ç®¡ç†
- âœ… åœ¨å–æ¶ˆè®¢é˜…åæ¸…ç†è®¢é˜…è€…
- âœ… åœ¨å–æ¶ˆæ³¨å†Œåæ¸…ç†ä»»åŠ¡
- âœ… åœ¨ clear() åæ¸…ç†æ‰€æœ‰èµ„æº

---

### 2. useCountdownManager Hook æµ‹è¯•

**æ–‡ä»¶**: `src/__tests__/hooks/useCountdownManager.test.tsx`

#### æµ‹è¯•åˆ†ç»„

##### åŸºç¡€åŠŸèƒ½
- âœ… è¿”å›å€’è®¡æ—¶æ•°æ®
- âœ… åœ¨ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ¸…ç†è®¢é˜…
- âœ… åœ¨ taskId å˜åŒ–æ—¶é‡æ–°è®¢é˜…
- âœ… åœ¨ targetDate å˜åŒ–æ—¶é‡æ–°æ³¨å†Œ

##### è¿‡æœŸå›è°ƒ
- âœ… åœ¨ä»»åŠ¡è¿‡æœŸæ—¶è§¦å‘å›è°ƒ
- âœ… ä½¿ç”¨æœ€æ–°çš„ onExpire å›è°ƒ

##### å®æ—¶æ›´æ–°
- âœ… éšæ—¶é—´æ›´æ–°å€’è®¡æ—¶
- âœ… åœ¨è¿‡æœŸååœæ­¢æ›´æ–°

##### è¿›åº¦è®¡ç®—
- âœ… æ­£ç¡®è®¡ç®—è¿›åº¦ç™¾åˆ†æ¯”
- âœ… åœ¨æ²¡æœ‰ startDate æ—¶è¿”å› 0 è¿›åº¦
- âœ… åœ¨è¿‡æœŸæ—¶è¿”å› 100% è¿›åº¦

##### å¤šç»„ä»¶å…±äº«
- âœ… å…è®¸å¤šä¸ªç»„ä»¶è®¢é˜…åŒä¸€ä»»åŠ¡
- âœ… åœ¨æ‰€æœ‰ç»„ä»¶å¸è½½åæ¸…ç†ä»»åŠ¡

##### è¾¹ç•Œæƒ…å†µ
- âœ… å¤„ç†æ— æ•ˆæ—¥æœŸ
- âœ… å¤„ç†å·²è¿‡æœŸçš„æ—¥æœŸ
- âœ… å¤„ç†ç©º taskId

---

### 3. æ€§èƒ½æµ‹è¯•

**æ–‡ä»¶**: `src/__tests__/performance/countdown.perf.test.ts`

#### æµ‹è¯•åœºæ™¯

##### å¤§é‡ä»»åŠ¡åœºæ™¯
- âœ… å¤„ç† 100 ä¸ªä»»åŠ¡ï¼ˆ< 100msï¼‰
- âœ… å¤„ç† 500 ä¸ªä»»åŠ¡ï¼ˆ< 500msï¼‰
- âœ… å¤„ç† 1000 ä¸ªä»»åŠ¡ï¼ˆ< 1ç§’ï¼‰

##### è®¢é˜…æ€§èƒ½
- âœ… å¿«é€Ÿå¤„ç† 100 ä¸ªè®¢é˜…ï¼ˆ< 100msï¼‰
- âœ… å¿«é€Ÿå–æ¶ˆ 100 ä¸ªè®¢é˜…ï¼ˆ< 100msï¼‰

##### å†…å­˜ä½¿ç”¨
- âœ… åœ¨å–æ¶ˆæ³¨å†Œåé‡Šæ”¾å†…å­˜
- âœ… åœ¨ clear() åé‡Šæ”¾æ‰€æœ‰å†…å­˜

##### RAF å¾ªç¯æ€§èƒ½
- âœ… ä½¿ç”¨å•ä¸€ RAF å¾ªç¯ç®¡ç†æ‰€æœ‰ä»»åŠ¡
- âœ… åœ¨æ²¡æœ‰ä»»åŠ¡æ—¶åœæ­¢ RAF å¾ªç¯

##### æ›´æ–°é¢‘ç‡
- âœ… èŠ‚æµè¿›åº¦æ›´æ–°

##### å¹¶å‘åœºæ™¯
- âœ… åŒæ—¶æ³¨å†Œå’Œå–æ¶ˆæ³¨å†Œä»»åŠ¡
- âœ… åŒæ—¶è®¢é˜…å’Œå–æ¶ˆè®¢é˜…

##### é•¿æ—¶é—´è¿è¡Œ
- âœ… ç¨³å®šè¿è¡Œ 10 ç§’

---

### 4. é›†æˆæµ‹è¯•

**æ–‡ä»¶**: `src/__tests__/integration/countdown-system.test.tsx`

#### æµ‹è¯•åœºæ™¯

##### ChronoCard é›†æˆ
- âœ… æ­£ç¡®æ¸²æŸ“å€’è®¡æ—¶
- âœ… åœ¨è¿‡æœŸæ—¶æ˜¾ç¤º EXPIRED
- âœ… åœ¨è¿‡æœŸæ—¶è§¦å‘å›è°ƒ
- âœ… æ˜¾ç¤ºè¿›åº¦æ¡
- âœ… æ”¯æŒç´§å‡‘æ¨¡å¼

##### å¤šä¸ª ChronoCard å…±äº«ä»»åŠ¡
- âœ… å…è®¸å¤šä¸ª ChronoCard æ˜¾ç¤ºåŒä¸€ä»»åŠ¡
- âœ… åœ¨æ‰€æœ‰å¡ç‰‡å¸è½½åæ¸…ç†è®¢é˜…

##### çŠ¶æ€é¢œè‰²
- âœ… åœ¨ç´§æ€¥æ—¶æ˜¾ç¤ºçº¢è‰²
- âœ… åœ¨æ­£å¸¸æ—¶æ˜¾ç¤ºé’è‰²

##### å®æ—¶æ›´æ–°
- âœ… éšæ—¶é—´æ›´æ–°æ˜¾ç¤º

##### æ€§èƒ½æµ‹è¯•
- âœ… æ¸²æŸ“ 100 ä¸ª ChronoCardï¼ˆ< 1ç§’ï¼‰

##### è¾¹ç•Œæƒ…å†µ
- âœ… å¤„ç†æ— æ•ˆæ—¥æœŸ
- âœ… å¤„ç†å·²è¿‡æœŸçš„æ—¥æœŸ
- âœ… å¤„ç†ç©º taskId

##### å†…å­˜æ³„æ¼æ£€æµ‹
- âœ… åœ¨å¸è½½åæ¸…ç†æ‰€æœ‰èµ„æº
- âœ… åœ¨é‡æ–°æ¸²æŸ“æ—¶ä¸æ³„æ¼è®¢é˜…

---

## ğŸ¯ æ€§èƒ½åŸºå‡†

### é¢„æœŸæ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹è¯•æ–¹æ³• |
|------|--------|---------|
| **æ³¨å†Œ 100 ä¸ªä»»åŠ¡** | < 100ms | `countdown.perf.test.ts` |
| **æ³¨å†Œ 1000 ä¸ªä»»åŠ¡** | < 1ç§’ | `countdown.perf.test.ts` |
| **100 ä¸ªè®¢é˜…** | < 100ms | `countdown.perf.test.ts` |
| **æ¸²æŸ“ 100 ä¸ª ChronoCard** | < 1ç§’ | `countdown-system.test.tsx` |
| **RAF å¾ªç¯æ•°é‡** | 1 ä¸ª | `countdownManager.test.ts` |
| **å†…å­˜æ³„æ¼** | 0 | æ‰€æœ‰æµ‹è¯• |

---

## ğŸ” ä»£ç è¦†ç›–ç‡

### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

```bash
npm run test:coverage
```

### æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š

```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
open coverage/index.html  # macOS
start coverage/index.html # Windows
```

### è¦†ç›–ç‡ç›®æ ‡

| æ–‡ä»¶ | ç›®æ ‡è¦†ç›–ç‡ |
|------|-----------|
| `countdownManager.ts` | > 90% |
| `useCountdownManager.ts` | > 90% |
| `ChronoCard.tsx` | > 80% |

---

## ğŸ› è°ƒè¯•æµ‹è¯•

### 1. ä½¿ç”¨æµ‹è¯• UI

```bash
npm run test:ui
```

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://localhost:51204/__vitest__/`

### 2. è°ƒè¯•å•ä¸ªæµ‹è¯•

```typescript
// ä½¿ç”¨ .only è¿è¡Œå•ä¸ªæµ‹è¯•
it.only('åº”è¯¥æ­£ç¡®æ³¨å†Œä»»åŠ¡', () => {
  // ...
});

// ä½¿ç”¨ .skip è·³è¿‡æµ‹è¯•
it.skip('åº”è¯¥æ­£ç¡®æ³¨å†Œä»»åŠ¡', () => {
  // ...
});
```

### 3. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

```bash
# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
npm test -- --reporter=verbose
```

### 4. è°ƒè¯•å¤±è´¥çš„æµ‹è¯•

```typescript
// åœ¨æµ‹è¯•ä¸­æ·»åŠ  console.log
it('åº”è¯¥æ­£ç¡®æ³¨å†Œä»»åŠ¡', () => {
  console.log('Task count:', countdownManager.getTaskCount());
  // ...
});
```

---

## ğŸ“ ç¼–å†™æ–°æµ‹è¯•

### æµ‹è¯•æ¨¡æ¿

```typescript
import { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';
import { countdownManager } from '../../utils/countdownManager';

describe('æ–°åŠŸèƒ½æµ‹è¯•', () => {
  beforeEach(() => {
    // æ¯ä¸ªæµ‹è¯•å‰çš„å‡†å¤‡å·¥ä½œ
    countdownManager.clear();
    vi.clearAllTimers();
  });

  afterEach(() => {
    // æ¯ä¸ªæµ‹è¯•åçš„æ¸…ç†å·¥ä½œ
    countdownManager.clear();
  });

  it('åº”è¯¥åšæŸäº‹', () => {
    // å‡†å¤‡
    const taskId = 'test-task-1';
    const targetDate = new Date(Date.now() + 10000).toISOString();

    // æ‰§è¡Œ
    countdownManager.register(taskId, targetDate);

    // æ–­è¨€
    expect(countdownManager.getTaskCount()).toBe(1);
  });
});
```

### React ç»„ä»¶æµ‹è¯•æ¨¡æ¿

```typescript
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import { ChronoCard } from '../../components/ChronoCard';

describe('ChronoCard æµ‹è¯•', () => {
  it('åº”è¯¥æ¸²æŸ“å€’è®¡æ—¶', () => {
    // å‡†å¤‡
    const taskId = 'test-task-1';
    const targetDate = new Date(Date.now() + 10000).toISOString();

    // æ‰§è¡Œ
    render(
      <ChronoCard
        taskId={taskId}
        targetDate={targetDate}
        compact={false}
      />
    );

    // æ–­è¨€
    expect(screen.getByText(/00:/)).toBeInTheDocument();
  });
});
```

---

## ğŸš¨ å¸¸è§é—®é¢˜

### 1. æµ‹è¯•è¶…æ—¶

**é—®é¢˜**: æµ‹è¯•è¿è¡Œè¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**:
```typescript
it('é•¿æ—¶é—´è¿è¡Œçš„æµ‹è¯•', async () => {
  // ...
}, 10000); // è®¾ç½® 10 ç§’è¶…æ—¶
```

### 2. RAF æœªè§¦å‘

**é—®é¢˜**: requestAnimationFrame å›è°ƒæœªæ‰§è¡Œ

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// åœ¨ setup.ts ä¸­å·²é…ç½® RAF mock
// å¦‚æœéœ€è¦æ‰‹åŠ¨è§¦å‘ï¼š
await new Promise(resolve => setTimeout(resolve, 100));
```

### 3. å†…å­˜æ³„æ¼è­¦å‘Š

**é—®é¢˜**: æµ‹è¯•åå‡ºç°å†…å­˜æ³„æ¼è­¦å‘Š

**è§£å†³æ–¹æ¡ˆ**:
```typescript
afterEach(() => {
  countdownManager.clear(); // ç¡®ä¿æ¸…ç†æ‰€æœ‰èµ„æº
});
```

### 4. å¼‚æ­¥æµ‹è¯•å¤±è´¥

**é—®é¢˜**: å¼‚æ­¥æ“ä½œæœªå®Œæˆå°±æ–­è¨€

**è§£å†³æ–¹æ¡ˆ**:
```typescript
import { waitFor } from '@testing-library/react';

await waitFor(() => {
  expect(onExpire).toHaveBeenCalled();
}, { timeout: 300 });
```

---

## ğŸ“ˆ æŒç»­é›†æˆ

### GitHub Actions é…ç½®ç¤ºä¾‹

```yaml
name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm install
      - run: npm run test:run
      - run: npm run test:coverage
      - uses: codecov/codecov-action@v3
        with:
          files: ./coverage/coverage-final.json
```

---

## âœ… æµ‹è¯•æ¸…å•

### Phase 2 éªŒè¯æ¸…å•

- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] æ‰€æœ‰ Hook æµ‹è¯•é€šè¿‡
- [ ] æ‰€æœ‰æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡
- [ ] ä»£ç è¦†ç›–ç‡ > 80%
- [ ] æ— å†…å­˜æ³„æ¼
- [ ] 100+ ä»»åŠ¡åœºæ™¯æ€§èƒ½è¾¾æ ‡
- [ ] é•¿æ—¶é—´è¿è¡Œç¨³å®šæ€§éªŒè¯

### æ‰‹åŠ¨æµ‹è¯•æ¸…å•

- [ ] åœ¨çœŸå®æµè§ˆå™¨ä¸­æµ‹è¯•
- [ ] æµ‹è¯•é¡µé¢éšè—/æ˜¾ç¤ºåˆ‡æ¢
- [ ] æµ‹è¯•å¤šæ ‡ç­¾é¡µåœºæ™¯
- [ ] æµ‹è¯•ç§»åŠ¨ç«¯æµè§ˆå™¨
- [ ] æµ‹è¯• Tauri æ¡Œé¢åº”ç”¨
- [ ] å‹åŠ›æµ‹è¯•ï¼ˆ1000+ ä»»åŠ¡ï¼‰
- [ ] é•¿æ—¶é—´è¿è¡Œæµ‹è¯•ï¼ˆ24å°æ—¶ï¼‰

---

## ğŸ”— ç›¸å…³èµ„æº

### æ–‡æ¡£
- [Vitest å®˜æ–¹æ–‡æ¡£](https://vitest.dev/)
- [Testing Library æ–‡æ¡£](https://testing-library.com/)
- [Jest DOM åŒ¹é…å™¨](https://github.com/testing-library/jest-dom)

### ç›¸å…³æ–‡ä»¶
- `COUNTDOWN_SYSTEM_IMPLEMENTATION.md` - å®ç°æ–‡æ¡£
- `vitest.config.ts` - Vitest é…ç½®
- `src/__tests__/setup.ts` - æµ‹è¯•ç¯å¢ƒé…ç½®

---

**æœ€åæ›´æ–°**: 2026-01-26  
**åˆ›å»ºè€…**: AI Assistant  
**çŠ¶æ€**: æµ‹è¯•å¥—ä»¶å·²åˆ›å»ºï¼Œç­‰å¾…è¿è¡ŒéªŒè¯
